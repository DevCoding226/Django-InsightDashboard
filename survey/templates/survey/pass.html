{% extends "base.html" %}
{% load static i18n compress %}

{% block content %}

    <form action="" method="post" id="survey-pass-form">{% csrf_token %}

        <div id="wizard" style="display:none">
            {% for item in items %}
                <h1>1</h1>
                <div class="step-content">
                    <div class="text-center m-t-md {{ item.question.type }}">
{#                        <h2>{{ item.question.get_type_template_name }}</h2>#}
                        {% include item.question.get_type_template_name with item=item %}
                    </div>
                </div>
            {% endfor %}
        </div>

    </form>
{% endblock content %}

{% block css %}{{ block.super }}
        <link href="{% static 'css/plugins/steps/jquery.steps.css' %}" rel="stylesheet">

{% endblock css %}

{% block javascript %}{{ block.super }}
        <script type="text/javascript" src="{% static 'js/plugins/jquery.steps/jquery.steps.min.js' %}"></script>

        <script type="text/javascript" src="{% static 'js/plugins/jquery.validate.min.js' %}"></script>
{% endblock javascript %}


{% block inlinescript %}

        var form = $('#survey-pass-form');
        var already_jumped = false;
        form.validate({
            onkeyup: true,
            highlight: function (element) {
                $(element).closest('.form-group').addClass('has-error');
            },
            unhighlight: function (element) {
                $(element).closest('.form-group').removeClass('has-error');
            },
            errorElement: 'div',
            errorClass: 'help-block',
            errorPlacement: function (error, element) {
                if (element.parent('.input-group').length) {
                    error.insertAfter(element.parent());
                } else {
                    error.insertAfter(element);
                }
            }
        });

        $("#wizard").steps({
            titleTemplate: '<span class="number">#index#</span>',
            onStepChanging: function (event, currentIndex, newIndex) {
                // Always allow going backward even if the current step contains invalid fields!
                // console.log('test');
                if (currentIndex > newIndex) {
                    return true;
                }


                // Clean up if user went backward before
                if (currentIndex < newIndex) {
                    // To remove error styles
                    $(".body:eq(" + newIndex + ") label.error", form).remove();
                    $(".body:eq(" + newIndex + ") .error", form).removeClass("error");
                }

                // Disable validation on fields that are disabled or hidden.
                form.validate().settings.ignore = ":disabled,:hidden";

                // Start validation; Prevent going forward if false
                // console.log(form.valid());
                return form.valid();
            },
            onStepChanged: function (event, currentIndex, priorIndex) {
                connect_dependend_widget_list([1, 2], 5);
                connect_dependend_widget_list([26, 27], 13);

                if (priorIndex == 6) {
                    if ($(".btn-type_yes_no-breaking-No.fancy-checked").length && !already_jumped) {
                        for (i=7; i<=14; i++) {
                            $('#wizard .actions a[href="#next"]').get(0).click();
                        }
                        already_jumped = true;
                    }
                }


            },

            onFinished: function (event, currentIndex) {
                $('#survey-pass-form').submit();
            },
        });

        $("#wizard").show();


{% endblock inlinescript %}
